<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.test.dao.UsertimeMapper" >
  <resultMap id="BaseResultMap" type="com.test.po.Usertime" >
    <id column="usertimeid" property="usertimeid" jdbcType="INTEGER" />
    <result column="utuid" property="userid" jdbcType="INTEGER" />
    <result column="datetime" property="datetime" jdbcType="TIMESTAMP" />
    <result column="starttime" property="starttime" jdbcType="TIMESTAMP" />
    <result column="endtime" property="endtime" jdbcType="TIMESTAMP" />
    <association property="user" javaType="User">
      <id column="uuid" property="userid" jdbcType="INTEGER" />
      <result column="username" property="username" jdbcType="VARCHAR" />
      <result column="department" property="department" jdbcType="VARCHAR" />
    </association>
  </resultMap>

  <!-- 批量插入数据 -->
  <insert id="insertBatch" parameterType="java.util.List" useGeneratedKeys="true">
    insert into  usertime(userid,datetime) values
    <foreach collection="dataList" item="data" index="index" separator=",">
       (#{data.userid,jdbcType=INTEGER},  #{data.datetime,jdbcType=TIMESTAMP})
    </foreach>
  </insert>


  <select id="selectByDateAndName" resultMap="BaseResultMap" resultType="com.test.po.Usertime">
    SELECT  usertime.userid utuid,`user`.userid uuid,usertimeid,`user`.username,datetime, MIN(datetime) starttime,MAX(datetime) endtime,`user`.department
    FROM usertime
    JOIN `user`
    ON usertime.userid=`user`.userid
    GROUP BY usertime.userid, DATE_FORMAT(datetime,'%Y-%m-%d')
    HAVING
    <if test="start!=null">
      datetime>=#{start}
    </if>
    <if test="end!=null">
      and datetime<![CDATA[<=]]>#{end}
    </if>
    <if test="name!=null">
      AND `user`.username like CONCAT ('%',#{name},'%')
    </if>
  </select>





</mapper>